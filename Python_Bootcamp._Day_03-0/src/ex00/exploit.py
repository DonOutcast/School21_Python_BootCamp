from bs4 import BeautifulSoup


def event_loop():
    with open("../../materials/evilcorp.html") as fp:
        soup = BeautifulSoup(fp, 'html.parser')

    soup.title.string = "Evil Corp - Stealing your money every day"

    username = soup.find('span', {'class': 'name'}).text
    new_header = soup.new_tag("h1")
    new_header.string = f"{username}, you are hacked!"
    soup.find_all('span', {'class': 'name'})[0].insert_after(new_header)

    new_script = soup.new_tag("script")
    new_script.string = """hacked = function() {
                alert('hacked');
            }
            window.addEventListener('load', 
              function() { 
                var f = document.querySelector("form");
                f.setAttribute("onsubmit", "hacked()");
              },
              false
            );
    """
    soup.body.append(new_script)

    hacked_link = soup.find_all('a')[0]
    hacked_link.string = "Fsociety"
    hacked_link['href'] = "https://mrrobot.fandom.com/wiki/Fsociety"

    with open("../../materials/evilcorp_hacked.html", "w") as file:
        file.write(str(soup))


if __name__ == "__main__":
    event_loop()
